<!-- PLOTLY -->
<script src='//cdn.plot.ly/plotly-latest.min.js'></script>
<style>
  @font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: 400;
    src: url('/fonts/OpenSans.eot');
    src: url('/fonts/OpenSans.eot?#iefix') format('embedded-opentype'),
     url('/fonts/OpenSans.woff') format('woff'),
     url('/fonts/OpenSans.ttf') format('truetype'),
     url('/fonts/OpenSans.svg#open_sansregular') format('svg');
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
  }

  div {
    font-family: 'Open Sans';
  }

  #wrapper h1 {
    position: absolute;
    z-index: 1000;
    width: 100%;
    text-align: center;
    color: <%= @textcolour %>;
    font-size: <%= @font_size %>;
    font-weight: 400;
    opacity: 0.7;
    line-height: 1em;
    padding: 0;
    top: 1em;
  }
</style>

<div id="wrapper">
  <h1><%= @title['en'] %></h1>
  <div id='chart'></div>
</div>
<script src='/javascripts/metrics.js'></script>
<script src='/javascripts/defiant.js'></script>
<script>
$.getJSON(document.URL + '?with_path=true', function(json) {
  pie(json)
})

function pie(json) {
  $('#chart').height($(window).height())

  var data = [{
    values: extractValues(json.value, '//total'),
    labels: extractKeys(json.value, '//total'),
    type: 'pie',
    textinfo: 'label+percent',
    marker: {
      colors: ['#FF6700', '#D60303']
    }
  }];

  var layout = {
    paper_bgcolor: '<%= @boxcolour %>',
    plot_bgcolor: '<%= @boxcolour %>',
    showlegend: false,
    margin: {
      l: 0, r: 0, t: 60, b: 30
    }
  };

  Plotly.newPlot('chart', data, layout, { displayModeBar: <%= @plotly_modebar %> });
}
</script>
